/*! CSSBelt.js - http://easelinc.github.io/cssbelt, built 04-10-2015 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x={}.hasOwnProperty,y=function(a,b){function c(){this.constructor=a}for(var d in b)x.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},z=function(a,b){return function(){return a.apply(b,arguments)}};c={},"undefined"!=typeof module?module.exports=c:window.Curve=c,k=window.SVG||require("./vendor/svg").SVG,k.Circle=function(a){function b(){b.__super__.constructor.call(this,k.create("circle"))}return y(b,a),b.prototype.cx=function(a){return null===a?this.attr("cx"):this.attr("cx",new k.Number(a).divide(this.trans.scaleX))},b.prototype.cy=function(a){return null===a?this.attr("cy"):this.attr("cy",new k.Number(a).divide(this.trans.scaleY))},b.prototype.radius=function(a){return this.attr({r:new k.Number(a)})},b}(k.Shape),k.extend(k.Container,{circle:function(a){return this.put(new k.Circle).radius(a).move(0,0)}}),k=window.SVG||require("./vendor/svg").SVG,k.extend(k.Element,{"export":function(a,b){var c,d,e,f,g,h,i,j,l,m,n,o;if(f=this.node.nodeName,g="",e="svg"===f&&!b,a=a||{},!a.exclude||!a.exclude.call(this)){if(a=a||{},b=b||0,e&&(g+=this._whitespaced('<?xml version="1.0" encoding="UTF-8"?>',a.whitespace,b),h=this.attr("width"),c=this.attr("height"),a.width&&this.attr("width",a.width),a.height&&this.attr("height",a.height)),g+=this._whitespaced("<"+f+this.attrToString()+">",a.whitespace,b),e&&(this.attr({width:h,height:c}),g+=this._whitespaced("<desc>Created with Curve</desc>",a.whitespace,b+1),this._defs)){for(g+=this._whitespaced("<defs>",a.whitespace,b+1),d=i=0,m=this._defs.children().length;m>=0?m>i:i>m;d=m>=0?++i:--i)g+=this._defs.children()[d]["export"](a,b+2);g+=this._whitespaced("</defs>",a.whitespace,b+1)}if(this instanceof k.Container)for(d=j=0,n=this.children().length;n>=0?n>j:j>n;d=n>=0?++j:--j)g+=this.children()[d]["export"](a,b+1);else if(this instanceof k.Text)for(d=l=0,o=this.lines.length;o>=0?o>l:l>o;d=o>=0?++l:--l)g+=this.lines[d]["export"](a,b+1);this instanceof k.TSpan&&(g+=this._whitespaced(this.node.firstChild.nodeValue,a.whitespace,b+1)),g+=this._whitespaced("</"+f+">",a.whitespace,b)}return g},exportAttr:function(a){return 0===arguments.length?this.data("svg-export-attr"):this.data("svg-export-attr",a)},attrToString:function(){var a,b,c,d,e,f;if(a=[],b=this.exportAttr(),c=this.attr(),"object"==typeof b)for(e in b)"data-svg-export-attr"!==e&&(c[e]=b[e]);for(e in c)f=c[e],"xlink"===e&&(e="xmlns:xlink"),d="id"===e&&f.indexOf("Svgjs")>-1,!d&&"data-svg-export-attr"!==e&&("stroke"!==e||parseFloat(c["stroke-width"])>0)&&a.push(e+'="'+f+'"');return a.length?" "+a.join(" "):""},_whitespaced:function(a,b,c){var d,e,f,g,h;if(b){if(f="",e=b===!0?"  ":b||"",c)for(d=g=h=c-1;0>=h?0>=g:g>=0;d=0>=h?++g:--g)f+=e;a=f+a+"\n"}return a}}),c["import"]=function(a,b){var d,e,f,g;return d={path:function(b){return[new c.Path(a,{svgEl:b})]}},f=document.createElement("div"),g={},f.innerHTML=b.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2></$1>"),e=[],o(f.childNodes,a,0,g,function(){var a;return a=this.node.nodeName,d[a]&&(e=e.concat(d[a](this))),null}),f=null,e},o=function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,p,q,t,u,v;for(k=p=0,t=a.length;t>=0?t>p:p>t;k=t>=0?++p:--p){switch(g=a[k],f={},h=[],n=g.nodeName.toLowerCase(),f=r(g),n){case"path":i=b[n]();break;case"polygon":i=b[n]();break;case"polyline":i=b[n]();break;case"rect":i=b[n](0,0);break;case"circle":i=b[n](0,0);break;case"ellipse":i=b[n](0,0);break;case"line":i=b.line(0,0,0,0);break;case"text":if(0===g.childNodes.length)i=b[n](g.textContent);else for(i=null,l=q=0,u=g.childNodes.length;u>=0?u>q:q>u;l=u>=0?++q:--q)j=g.childNodes[l],"tspan"===j.nodeName.toLowerCase()&&(null===i?i=b[n](j.textContent):i.tspan(j.textContent).attr(r(j)));break;case"image":i=b.image(f["xlink:href"]);break;case"g":case"svg":i=b["g"===n?"group":"nested"](),o(g.childNodes,i,c+1,d,e);break;case"defs":o(g.childNodes,b.defs(),c+1,d,e);break;case"use":i=b.use();break;case"clippath":case"mask":i=b[null!=(v="mask"===n)?v:{mask:"clip"}](),o(g.childNodes,i,c+1,d,e);break;case"lineargradient":case"radialgradient":i=b.defs().gradient(n.split("gradient")[0],function(a){var b,c,d;for(d=[],l=b=0,c=g.childNodes.length;c>=0?c>b:b>c;l=c>=0?++b:--b)d.push(a.at(r(g.childNodes[l])).style(g.childNodes[l].getAttribute("style")));return d});break;case"#comment":case"#text":case"metadata":case"desc":break;default:console.log("SVG Import got unexpected type "+n,g)}i&&(m=s(f.transform),delete f.transform,i.attr(f).transform(m),i.attr("id")&&(d[i.attr("id")]=i),"text"===n&&i.rebuild(),"function"==typeof e&&e.call(i))}return b},r=function(a){var b,c,d,e,f;if(c=a.attributes||[],b={},c.length)for(d=e=f=c.length-1;0>=f?0>=e:e>=0;d=0>=f?++e:--e)b[c[d].nodeName]=c[d].nodeValue;return b},s=function(a){var b,c,d,e,f,g,h,i;if(f={},d=(a||"").match(/[A-Za-z]+\([^\)]+\)/g)||[],b=k.defaults.trans(),d.length)for(c=h=i=d.length-1;0>=i?0>=h:h>=0;c=0>=i?++h:--h)switch(e=d[c].match(/([A-Za-z]+)\(([^\)]+)\)/),g=(e[2]||"").replace(/^\s+/,"").replace(/,/g," ").replace(/\s+/g," ").split(" "),e[1]){case"matrix":f.a=parseFloat(g[0])||b.a,f.b=parseFloat(g[1])||b.b,f.c=parseFloat(g[2])||b.c,f.d=parseFloat(g[3])||b.d,f.e=parseFloat(g[4])||b.e,f.f=parseFloat(g[5])||b.f;break;case"rotate":f.rotation=parseFloat(g[0])||b.rotation,f.cx=parseFloat(g[1])||b.cx,f.cy=parseFloat(g[2])||b.cy;break;case"scale":f.scaleX=parseFloat(g[0])||b.scaleX,f.scaleY=parseFloat(g[1])||b.scaleY;break;case"skewX":f.skewX=parseFloat(g[0])||b.skewX;break;case"skewY":f.skewY=parseFloat(g[0])||b.skewY;break;case"translate":f.x=parseFloat(g[0])||b.x,f.y=parseFloat(g[1])||b.y}return f},v=window._||require("underscore"),a=window.jQuery||require("jquery"),h=function(){function b(a,b){this.svgToolParent=a,this.selectionModel=b,this.onDraggingHandleOut=z(this.onDraggingHandleOut,this),this.onDraggingHandleIn=z(this.onDraggingHandleIn,this),this.onDraggingNode=z(this.onDraggingNode,this),this.render=z(this.render,this),this.svgDocument=this.svgToolParent.parent,this._setupNodeElement(),this._setupLineElement(),this._setupHandleElements(),this.hide()}var d,e,f,g;return b.prototype.nodeSize=5,b.prototype.handleSize=3,f=null,g=null,d=null,e=null,b.prototype.hide=function(){return this.visible=!1,this.lineElement.hide(),this.nodeElement.hide(),this.handleElements.hide()},b.prototype.show=function(a){return this.visible=!0,this.nodeElement.show(),a&&(this.lineElement.front(),this.nodeElement.front(),this.handleElements.front()),this.enableHandles?(this.lineElement.show(),this.handleElements.show()):(this.lineElement.hide(),this.handleElements.hide())},b.prototype.setEnableHandles=function(a){return this.enableHandles=a,this.visible?this.show():void 0},b.prototype.setNode=function(a){return this._unbindNode(this.node),this.node=a,this._bindNode(this.node),this.setEnableHandles(!1),this.render()},b.prototype.render=function(){var a,b,c,d;return this.node?(a=this.node.getAbsoluteHandleIn(),b=this.node.getAbsoluteHandleOut(),d=this.node.point,c="M"+a.x+","+a.y+"L"+d.x+","+d.y+"L"+b.x+","+b.y,this.lineElement.attr({d:c}),this.handleElements.members[0].attr({cx:a.x,cy:a.y}),this.handleElements.members[1].attr({cx:b.x,cy:b.y}),this.nodeElement.attr({cx:d.x,cy:d.y}),this.show(),this._draggingHandle?this._draggingHandle.front():void 0):this.hide()},b.prototype.onDraggingNode=function(a,b){return this.node.setPoint(this.pointForEvent(b))},b.prototype.onDraggingHandleIn=function(a,b){return this.node.setAbsoluteHandleIn(this.pointForEvent(b))},b.prototype.onDraggingHandleOut=function(a,b){return this.node.setAbsoluteHandleOut(this.pointForEvent(b))},b.prototype.pointForEvent=function(b){var d,e,f,g,h;return d=b.clientX,e=b.clientY,h=a(this.svgDocument.node).offset(),g=h.top,f=h.left,new c.Point(b.clientX-f,b.clientY-g)},b.prototype._bindNode=function(a){return a?a.addListener("change",this.render):void 0},b.prototype._unbindNode=function(a){return a?a.removeListener("change",this.render):void 0},b.prototype._setupNodeElement=function(){var a=this;return this.nodeElement=this.svgToolParent.circle(this.nodeSize),this.nodeElement.node.setAttribute("class","node-editor-node"),this.nodeElement.click(function(b){return b.stopPropagation(),a.setEnableHandles(!0),a.selectionModel.setSelectedNode(a.node),!1}),this.nodeElement.draggable(),this.nodeElement.dragstart=function(){return a.selectionModel.setSelectedNode(a.node)},this.nodeElement.dragmove=this.onDraggingNode,this.nodeElement.on("mouseover",function(){return a.nodeElement.front(),a.nodeElement.attr({r:a.nodeSize+2})}),this.nodeElement.on("mouseout",function(){return a.nodeElement.attr({r:a.nodeSize})})},b.prototype._setupLineElement=function(){return this.lineElement=this.svgToolParent.path(""),this.lineElement.node.setAttribute("class","node-editor-lines")},b.prototype._setupHandleElements=function(){var a,b,c,d,e=this;return d=this,this.handleElements=this.svgToolParent.set(),this.handleElements.add(this.svgToolParent.circle(this.handleSize),this.svgToolParent.circle(this.handleSize)),this.handleElements.members[0].node.setAttribute("class","node-editor-handle"),this.handleElements.members[1].node.setAttribute("class","node-editor-handle"),this.handleElements.click(function(a){return a.stopPropagation(),!1}),b=function(){return d._draggingHandle=this},c=function(){return d._draggingHandle=null},this.handleElements.members[0].draggable(),this.handleElements.members[0].dragmove=this.onDraggingHandleIn,this.handleElements.members[0].dragstart=b,this.handleElements.members[0].dragend=c,this.handleElements.members[1].draggable(),this.handleElements.members[1].dragmove=this.onDraggingHandleOut,this.handleElements.members[1].dragstart=b,this.handleElements.members[1].dragend=c,a=function(a){return e.handleElements.members[0].node===a?e.handleElements.members[0]:e.handleElements.members[1]},this.handleElements.on("mouseover",function(){var b;return b=a(this),b.front(),b.attr({r:d.handleSize+2})}),this.handleElements.on("mouseout",function(){var b;return b=a(this),b.attr({r:d.handleSize})})},b}(),c.NodeEditor=h,v=window._||require("underscore"),d=window.EventEmitter||require("events").EventEmitter,g=function(a){function b(a,b,c,d){this.isJoined=null!=d?d:!1,this.setPoint(a),b&&this.setHandleIn(b),c&&this.setHandleOut(c)}return y(b,a),b.prototype.join=function(a){return null==a&&(a="handleIn"),this.isJoined=!0,this["set"+a.replace("h","H")](this[a])},b.prototype.getAbsoluteHandleIn=function(){return this.handleIn?this.point.add(this.handleIn):this.point},b.prototype.getAbsoluteHandleOut=function(){return this.handleOut?this.point.add(this.handleOut):this.point},b.prototype.setAbsoluteHandleIn=function(a){return this.setHandleIn(j.create(a).subtract(this.point))},b.prototype.setAbsoluteHandleOut=function(a){return this.setHandleOut(j.create(a).subtract(this.point))},b.prototype.setPoint=function(a){return this.set("point",j.create(a))},b.prototype.setHandleIn=function(a){return a&&(a=j.create(a)),this.set("handleIn",a),this.isJoined?this.set("handleOut",a?new c.Point(0,0).subtract(a):a):void 0},b.prototype.setHandleOut=function(a){return a&&(a=j.create(a)),this.set("handleOut",a),this.isJoined?this.set("handleIn",a?new c.Point(0,0).subtract(a):a):void 0},b.prototype.computeIsjoined=function(){return this.isJoined=!this.handleIn&&!this.handleOut||this.handleIn&&this.handleOut&&Math.round(this.handleIn.x)===Math.round(-this.handleOut.x)&&Math.round(this.handleIn.y)===Math.round(-this.handleOut.y)},b.prototype.set=function(a,b){var c,d,e;return e=this[a],this[a]=b,c="change:"+a,d={event:c,value:b,old:e},this.emit(c,this,d),this.emit("change",this,d)},b}(d),c.Node=g,c.ObjectSelection=function(){function a(a,b){var c;this.svgDocument=a,this.options=null!=b?b:{},this.render=z(this.render,this),null==(c=this.options)["class"]&&(c["class"]="object-selection")}return a.prototype.setObject=function(a){return this._unbindObject(this.object),this.object=a,this._bindObject(this.object),this.path&&this.path.remove(),this.path=null,this.object?(this.path=this.svgDocument.path("").back(),this.path.node.setAttribute("class",this.options["class"]+" invisible-to-hit-test"),this.render()):void 0},a.prototype.render=function(){return this.object.render(this.path)},a.prototype.disableDragging=function(){var a;return"function"==typeof(a=this.path).fixed&&a.fixed(),this.path.dragstart=null,this.path.dragmove=null,this.path.dragend=null},a.prototype.enableDragging=function(a){var b,c;this.disableDragging(),this.path.draggable();for(c in a)b=a[c],this.path[c]=b},a.prototype._bindObject=function(a){return a?a.on("change",this.render):void 0},a.prototype._unbindObject=function(a){return a?a.removeListener("change",this.render):void 0},a}(),v=window._||require("underscore"),w=["COMMAND","NUMBER"],b=w[0],f=w[1],t=function(a){var b;return b=q(a),u(p(b))},u=function(a){var b,c,d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t,u,w,x,y,z,A,B,C,D;if(p={subpaths:[]},1===a.length&&("M"===(y=a[0].type)||"m"===y))return p;for(e=null,f=null,b=function(a){var b;return b=new g(a),f={closed:!1,nodes:[b]},p.subpaths.push(f),b},q=function(a,b){return[a[b],a[b+1]]},m=function(a){return v.map(a,function(a,b){return a+e[b%2]})},d=function(b,c){var d,h,i,j;return e=b,i=null,d=f.nodes[0],h=a[c+1],h&&("z"===(j=h.type)||"Z"===j)&&d&&d.point.equals(e)||(i=new g(e),f.nodes.push(i)),i},k=s=0,z=a.length;z>=0?z>s:s>z;k=z>=0?++s:--s)switch(c=a[k],c.type){case"M":e=c.parameters,b(e);break;case"L":case"l":o=c.parameters,"l"===c.type&&(o=m(o)),d(q(o,0),k);break;case"H":case"h":o=c.parameters,"h"===c.type&&(o=m(o)),d([o[0],e[1]],k);break;case"V":case"v":o=c.parameters,"v"===c.type&&(o=m([0,o[0]]),o=o.slice(1)),d([e[0],o[0]],k);break;case"C":case"c":case"Q":case"q":o=c.parameters,("c"===(A=c.type)||"q"===A)&&(o=m(o)),"C"===(B=c.type)||"c"===B?(e=q(o,4),i=q(o,2),j=q(o,0)):(e=q(o,2),i=j=q(o,0)),l=f.nodes[f.nodes.length-1],l.setAbsoluteHandleOut(j),(n=d(e,k))?n.setAbsoluteHandleIn(i):(h=f.nodes[0],h.setAbsoluteHandleIn(i));break;case"S":case"s":o=c.parameters,"s"===c.type&&(o=m(o)),e=q(o,2),i=q(o,0),l=f.nodes[f.nodes.length-1],l.join("handleIn"),(n=d(e,k))?n.setAbsoluteHandleIn(i):(h=f.nodes[0],h.setAbsoluteHandleIn(i));break;case"T":case"t":o=c.parameters,"t"===c.type&&(o=m(o)),e=q(o,0),l=f.nodes[f.nodes.length-1],l.join("handleIn"),i=l.getAbsoluteHandleOut(),(n=d(e,k))?n.setAbsoluteHandleIn(i):(h=f.nodes[0],h.setAbsoluteHandleIn(i));break;case"Z":case"z":f.closed=!0}for(C=p.subpaths,t=0,w=C.length;w>t;t++)for(r=C[t],D=r.nodes,u=0,x=D.length;x>u;u++)n=D[u],n.computeIsjoined();return p},p=function(a){var c,d,e,g,h,i,j;for(d=[],e=i=0,j=a.length;j>=0?j>i:i>j;e=j>=0?++i:--i)if(h=a[e],h.type===b){for(c={type:h.string,parameters:[]};(g=a[e+1])&&g.type===f;)c.parameters.push(parseFloat(g.string)),e++;d.push(c)}return d},q=function(a){var c,d,e,g,h,i,j,k,l;for(e="-0123456789.",i=" ,\n	",j=[],d=null,h=function(a){return d&&d.type!==a?g():void 0},g=function(){return d?(d.string.join&&(d.string=d.string.join("")),j.push(d),d=null):void 0},k=0,l=a.length;l>k;k++)c=a[k],e.indexOf(c)>-1?(h(f),"-"===c&&g(),d||(d={type:f,string:[]}),d.string.push(c)):i.indexOf(c)>-1?g():(g(),j.push({type:b,string:c}));return g(),j},c.PathParser={lexPath:q,parsePath:t,groupCommands:p,parseTokens:u},v=window._||require("underscore"),d=window.EventEmitter||require("events").EventEmitter,n={fill:"#eee",stroke:"none"},e=0,i=function(a){function b(a,b){var c;this.svgDocument=a,c=(null!=b?b:{}).svgEl,this.onSubpathChange=z(this.onSubpathChange,this),this.onSubpathEvent=z(this.onSubpathEvent,this),this.id=e++,this.subpaths=[],this._setupSVGObject(c)}return y(b,a),b.prototype.toString=function(){return"Path "+this.id+" "+this.toPathString()},b.prototype.toPathString=function(){var a;return function(){var b,c,d,e;for(d=this.subpaths,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.toPathString());return e}.call(this).join(" ")},b.prototype.getNodes=function(){var a;return v.flatten(function(){var b,c,d,e;for(d=this.subpaths,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.getNodes());return e}.call(this),!0)},b.prototype.addNode=function(a){return this._addCurrentSubpathIfNotPresent(),this.currentSubpath.addNode(a)},b.prototype.insertNode=function(a,b){return this._addCurrentSubpathIfNotPresent(),this.currentSubpath.insertNode(a,b)},b.prototype.close=function(){return this._addCurrentSubpathIfNotPresent(),this.currentSubpath.close()},b.prototype._addCurrentSubpathIfNotPresent=function(){return this.currentSubpath?void 0:this.currentSubpath=this._createSubpath()},b.prototype.addSubpath=function(a){var b;return this.subpaths.push(a),this._bindSubpath(a),b={event:"add:subpath",value:a},this.emit(b.event,this,b),this.emit("change",this,b),a},b.prototype.render=function(a){var b;return null==a&&(a=this.svgEl),b=this.toPathString(),b?a.attr({d:b}):void 0},b.prototype.onSubpathEvent=function(a,b){return this.emit(b.event,this,v.extend({subpath:a},b))},b.prototype.onSubpathChange=function(a,b){return this.render(),this.emit("change",this,v.extend({subpath:a},b))},b.prototype._createSubpath=function(a){return this.addSubpath(new l(v.extend({path:this},a)))},b.prototype._bindSubpath=function(a){return a?(a.on("change",this.onSubpathChange),a.on("close",this.onSubpathEvent),a.on("insert:node",this.onSubpathEvent),a.on("replace:nodes",this.onSubpathEvent)):void 0},b.prototype._unbindSubpath=function(a){return a?(a.off("change",this.onSubpathChange),a.off("close",this.onSubpathEvent),a.off("insert:node",this.onSubpathEvent),a.off("replace:nodes",this.onSubpathEvent)):void 0},b.prototype._parseFromPathString=function(a){var b,d,e,f,g;if(a){for(b=c.PathParser.parsePath(a),g=b.subpaths,e=0,f=g.length;f>e;e++)d=g[e],this._createSubpath(d);return this.currentSubpath=v.last(this.subpaths),null}},b.prototype._setupSVGObject=function(a){return this.svgEl=a,this.svgEl||(this.svgEl=this.svgDocument.path().attr(n)),c.Utils.setObjectOnNode(this.svgEl.node,this),this._parseFromPathString(this.svgEl.attr("d"))},b}(d),c.Path=i,c.PenTool=function(){function a(a,b){var c;this.svgDocument=a,c=null!=b?b:{},this.selectionModel=c.selectionModel,this.selectionView=c.selectionView,this.onMouseUp=z(this.onMouseUp,this),this.onMouseMove=z(this.onMouseMove,this),this.onMouseDown=z(this.onMouseDown,this)}return a.prototype.currentObject=null,a.prototype.currentNode=null,a.prototype.activate=function(){return this.svgDocument.on("mousedown",this.onMouseDown),this.svgDocument.on("mousemove",this.onMouseMove),this.svgDocument.on("mouseup",this.onMouseUp)},a.prototype.deactivate=function(){return this.svgDocument.off("mousedown",this.onMouseDown),this.svgDocument.off("mousemove",this.onMouseMove),this.svgDocument.off("mouseup",this.onMouseUp)},a.prototype.onMouseDown=function(a){var b,d=this;return b=function(){return d.currentNode=new c.Node([a.clientX,a.clientY],[0,0],[0,0]),d.currentObject.addNode(d.currentNode),d.selectionModel.setSelectedNode(d.currentNode)},this.currentObject?this.selectionView.nodeEditors.length&&a.target===this.selectionView.nodeEditors[0].nodeElement.node?(this.currentObject.close(),this.currentObject=null):b():(this.currentObject=new c.Path(this.svgDocument),this.selectionModel.setSelected(this.currentObject),b())},a.prototype.onMouseMove=function(a){return this.currentNode?this.currentNode.setAbsoluteHandleOut([a.clientX,a.clientY]):void 0},a.prototype.onMouseUp=function(a){return this.currentNode=null},a}(),v=window._||require("underscore"),j=function(){function a(a,b){this.set(a,b)}return a.create=function(b,c){return b instanceof a?b:new a(b,c)},a.prototype.set=function(a,b){var c;return this.x=a,this.y=b,v.isArray(this.x)?(c=this.x,this.x=c[0],this.y=c[1],c):void 0},a.prototype.add=function(b){return b=a.create(b),new a(this.x+b.x,this.y+b.y)},a.prototype.subtract=function(b){return b=a.create(b),new a(this.x-b.x,this.y-b.y)},a.prototype.toArray=function(){return[this.x,this.y]},a.prototype.equals=function(b){return b=a.create(b),b.x===this.x&&b.y===this.y},a}(),c.Point=j,a=window.jQuery||require("underscore"),c.PointerTool=function(){function b(a,b){var c;this.svgDocument=a,c=null!=b?b:{},this.selectionModel=c.selectionModel,this.selectionView=c.selectionView,this.onMouseMove=z(this.onMouseMove,this),this.onClick=z(this.onClick,this),this.onChangedSelected=z(this.onChangedSelected,this),this._evrect=this.svgDocument.node.createSVGRect(),this._evrect.width=this._evrect.height=1}return b.prototype.activate=function(){return this.svgDocument.on("click",this.onClick),this.svgDocument.on("mousemove",this.onMouseMove),this.selectionModel.on("change:selected",this.onChangedSelected)},b.prototype.deactivate=function(){return this.svgDocument.off("click",this.onClick),this.svgDocument.off("mousemove",this.onMouseMove),this.selectionModel.off("change:selected",this.onChangedSelected)},b.prototype.onChangedSelected=function(a){var b,c;return b=a.object,c=this.selectionView.getObjectSelection(),null!=b?c.enableDragging({dragstart:function(a){return console.log("start",a)},dragmove:function(a){return console.log("move",a)},dragend:function(a){return console.log("end",a)}}):c.disableDragging()},b.prototype.onClick=function(a){var b;return b=this._hitWithTarget(a),this.selectionModel.setSelected(b),b?!1:void 0},b.prototype.onMouseMove=function(a){return this.selectionModel.setPreselected(this._hitWithTarget(a))},b.prototype._hitWithTarget=function(a){var b;return b=null,a.target!==this.svgDocument.node&&(b=c.Utils.getObjectFromNode(a.target)),b},b.prototype._hitWithIntersectionList=function(b){var d,e,f,g,h,i,j,k,l;if(k=a(this.svgDocument.node).offset(),f=k.left,i=k.top,this._evrect.x=b.clientX-f,this._evrect.y=b.clientY-i,g=this.svgDocument.node.getIntersectionList(this._evrect,null),h=null,g.length)for(e=j=l=g.length-1;0>=l?0>=j:j>=0;e=0>=l?++j:--j)if(d=g[e].getAttribute("class"),!(d&&d.indexOf("invisible-to-hit-test")>-1)){h=c.Utils.getObjectFromNode(g[e]);break}return h},b}(),d=window.EventEmitter||require("events").EventEmitter,c.SelectionModel=function(a){function b(){this.preselected=null,this.selected=null,this.selectedNode=null}return y(b,a),b.prototype.setPreselected=function(a){var b;if(a!==this.preselected&&(!a||a!==this.selected))return b=this.preselected,this.preselected=a,this.emit("change:preselected",{object:this.preselected,old:b})},b.prototype.setSelected=function(a){var b;if(a!==this.selected)return b=this.selected,this.selected=a,this.preselected===a&&this.setPreselected(null),this.emit("change:selected",{object:this.selected,old:b})},b.prototype.setSelectedNode=function(a){var b;if(a!==this.selectedNode)return b=this.selectedNode,this.selectedNode=a,this.emit("change:selectedNode",{node:this.selectedNode,old:b})},b.prototype.clearSelected=function(){return this.setSelected(null)},b.prototype.clearPreselected=function(){return this.setPreselected(null)},b.prototype.clearSelectedNode=function(){return this.setSelectedNode(null)},b}(d),c.SelectionView=function(){function a(a,b){this.svgDocument=a,this.model=b,this.onInsertNode=z(this.onInsertNode,this),this.onChangeSelectedNode=z(this.onChangeSelectedNode,this),this.onChangePreselected=z(this.onChangePreselected,this),this.onChangeSelected=z(this.onChangeSelected,this),this.path=null,this.nodeEditors=[],this._nodeEditorStash=[],this.objectSelection=new c.ObjectSelection(this.svgDocument),this.objectPreselection=new c.ObjectSelection(this.svgDocument,{"class":"object-preselection"}),this.model.on("change:selected",this.onChangeSelected),this.model.on("change:preselected",this.onChangePreselected),this.model.on("change:selectedNode",this.onChangeSelectedNode)}return a.prototype.nodeSize=5,a.prototype.getObjectSelection=function(){return this.objectSelection},a.prototype.onChangeSelected=function(a){var b,c;return b=a.object,c=a.old,this._unbindFromObject(c),this._bindToObject(b),this.setSelectedObject(b)},a.prototype.onChangePreselected=function(a){var b;return b=a.object,this.objectPreselection.setObject(b)},a.prototype.onChangeSelectedNode=function(a){var b,c,d;return b=a.node,d=a.old,c=this._findNodeEditorForNode(d),c&&c.setEnableHandles(!1),c=this._findNodeEditorForNode(b),c?c.setEnableHandles(!0):void 0},a.prototype.setSelectedObject=function(a){return this.objectSelection.setObject(a),this._createNodeEditors(a)},a.prototype.onInsertNode=function(a,b){var c,d,e;return e=null!=b?b:{},d=e.value,c=e.index,this._addNodeEditor(d),null},a.prototype._bindToObject=function(a){return a?a.on("insert:node",this.onInsertNode):void 0},a.prototype._unbindFromObject=function(a){return a?a.removeListener("insert:node",this.onInsertNode):void 0},a.prototype._createNodeEditors=function(a){var b,c,d,e,f,g,h,i,j;if(this._nodeEditorStash=this._nodeEditorStash.concat(this.nodeEditors),this.nodeEditors=[],a)for(d=a.getNodes(),e=0,g=d.length;g>e;e++)b=d[e],this._addNodeEditor(b);for(i=this._nodeEditorStash,j=[],f=0,h=i.length;h>f;f++)c=i[f],j.push(c.setNode(null));return j},a.prototype._addNodeEditor=function(a){var b;return a?(b=this._nodeEditorStash.length?this._nodeEditorStash.pop():new c.NodeEditor(this.svgDocument,this.model),b.setNode(a),this.nodeEditors.push(b),!0):!1},a.prototype._findNodeEditorForNode=function(a){var b,c,d,e;for(e=this.nodeEditors,c=0,d=e.length;d>c;c++)if(b=e[c],b.node===a)return b;return null},a}(),v=window._||require("underscore"),d=window.EventEmitter||require("events").EventEmitter,l=function(a){function b(a){var b,c;c=null!=a?a:{},this.path=c.path,this.closed=c.closed,b=c.nodes,this.onNodeChange=z(this.onNodeChange,this),this.nodes=[],this.setNodes(b),this.closed=!!this.closed}return y(b,a),b.prototype.toString=function(){return"Subpath "+this.toPathString()},b.prototype.toPathString=function(){var a,b,c,d,e,f,g,h,i;for(f="",c=null,d=function(a,b){var c;return c="",a.handleOut||b.handleIn?(c=[],c=c.concat(a.getAbsoluteHandleOut().toArray()),c=c.concat(b.getAbsoluteHandleIn().toArray()),c=c.concat(b.point.toArray()),c="C"+c.join(",")):c=a.point.x===b.point.x?"V"+b.point.y:a.point.y===b.point.y?"H"+b.point.x:"L"+b.point.toArray().join(","),c},a=function(a,b){var c;return a&&b?(c="",(b.handleOut||a.handleIn)&&(c+=d(b,a)),c+="Z"):""},i=this.nodes,g=0,h=i.length;h>g;g++)e=i[g],f+=f?d(b,e):"M"+e.point.toArray().join(","),b=e;return this.closed&&(f+=a(this.nodes[0],this.nodes[this.nodes.length-1])),f},b.prototype.getNodes=function(){return this.nodes},b.prototype.setNodes=function(a){var b,c,d,e,f,g,h;if(a&&v.isArray(a)){for(h=this.nodes,d=0,f=h.length;f>d;d++)c=h[d],this._unbindNode(c);for(e=0,g=a.length;g>e;e++)c=a[e],this._bindNode(c);return this.nodes=a,b={event:"replace:nodes",value:this.nodes},this.emit(b.event,this,b),this.emit("change",this,b)}},b.prototype.addNode=function(a){return this.insertNode(a,this.nodes.length)},b.prototype.insertNode=function(a,b){var c;return this._bindNode(a),this.nodes.splice(b,0,a),c={event:"insert:node",index:b,value:a},this.emit("insert:node",this,c),this.emit("change",this,c)},b.prototype.close=function(){var a;return this.closed=!0,a={event:"close"},this.emit("close",this,a),this.emit("change",this,a)},b.prototype.onNodeChange=function(a,b){var c;return c=this._findNodeIndex(a),this.emit("change",this,v.extend({index:c},b))},b.prototype._bindNode=function(a){return a.on("change",this.onNodeChange)},b.prototype._unbindNode=function(a){return a.off("change",this.onNodeChange)},b.prototype._findNodeIndex=function(a){var b,c,d;for(b=c=0,d=this.nodes.length;d>=0?d>c:c>d;b=d>=0?++c:--c)if(this.nodes[b]===a)return b;return-1},b}(d),c.Subpath=l,k=window.SVG||require("./vendor/svg").SVG,m=function(){function a(a){this.objects=[],this.svgDocument=k(a),this.toolLayer=this.svgDocument.group(),this.toolLayer.node.setAttribute("class","tool-layer"),this.selectionModel=new c.SelectionModel,this.selectionView=new c.SelectionView(this.toolLayer,this.selectionModel),this.tool=new c.PointerTool(this.svgDocument,{selectionModel:this.selectionModel,selectionView:this.selectionView}),this.tool.activate()}return a.prototype.deserialize=function(a){return this.objects=c["import"](this.svgDocument,a),this.toolLayer.front()},a.prototype.serialize=function(){var a;return a=this.getSvgRoot(),a?a["export"]({whitespace:!0}):""},a.prototype.getSvgRoot=function(){var a;return a=null,this.svgDocument.each(function(){return"svg"===this.node.nodeName?a=this:void 0}),a},a}(),c.SvgDocument=m,v=window._||require("underscore"),a=window.jQuery||require("jquery"),c.Utils={getObjectFromNode:function(b){return a.data(b,"curve.object")},setObjectOnNode:function(b,c){return a.data(b,"curve.object",c)},pointForEvent:function(b,d){var e,f,g,h,i;return e=d.clientX,f=d.clientY,i=a(b.node).offset(),h=i.top,g=i.left,new c.Point(d.clientX-g,d.clientY-h)}}}).call(this);